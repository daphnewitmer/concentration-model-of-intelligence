import matplotlib.pyplot as pltimport numpy as npfrom src import parameters as paramsclass Test:    def __init__(self, simulation, learning_matrix):        self.simulation = simulation        self.learning_matrix = learning_matrix    def run(self):        fig, axs = plt.subplots(2, 4)        self.check_knowledge_structure(axs, (0, 0), 1)        self.check_item_variation('knowledge', axs, (0, 1), 2)  # knowledge or test        self.check_item_variation('test', axs, (0, 2), 3)  # knowledge or test        self.check_test_structure(axs, (0, 3), 4)        self.check_learning_structure(axs, (1, 0), 5)        self.check_learning_correlations(axs, (1, 1), 6)        self.check_iq_scores(axs, (1, 2), 'cog_cap', 7)        self.check_iq_scores(axs, (1, 3), 'concentration', 8)        parameters = 'PARAMETERS \nPercentage random: ' + str(params.PERC_RAND) \                     + '\nAcquired knowledge weight: ' + str(params.ACQ_KNOWL_WEIGHT) \                     + '%\nStart percentage cog cap: ' + str(params.START_PERC_COG_CAP) + '%'        plt.figtext(0.01, 0.9, parameters)        plt.show()    def check_knowledge_structure(self, axs, place, plot_nr):        """ Plot with required cognitive capacity and average cognitive capacity for m in knowledge matrix in order of schooling matrix """        person = 2        cog_cap = self.simulation.get_cog_cap(person)        conc = self.simulation.concentration_matrix[:, person]        axs[place].plot(np.arange(params.nrOfMicroskillsNormal), cog_cap, label='Person (p=' + str(person) + ') Cognitive Capacity')        axs[place].plot(np.arange(params.nrOfMicroskillsNormal), conc, label='Person (p=' + str(person) + ') Concentration', zorder=1, color='bisque')        axs[place].plot(np.arange(params.nrOfMicroskillsNormal),                 self.simulation.knowledge_matrix[:, 0],  # [self.simulation.schooling_matrix[person,:]]                 label='Required Cognitive Capacity',                 zorder=0,                 color='paleturquoise')        axs[place].set_xlabel('Microskills')        axs[place].set_ylabel('Cognitive Capacity')        axs[place].set_title(str(plot_nr) + ': Knowledge Structure')        axs[place].legend()    def check_item_variation(self, matrix, axs, place, plot_nr):        """ Plot sum knowledge to check variation between skilss """        if matrix == 'test':            matrix = self.simulation.test_matrix            title = str(plot_nr) + ': Variation Between Item Connectedness IQ test'        elif matrix == 'knowledge':            matrix = self.simulation.knowledge_matrix            title = str(plot_nr) + ': Variation Between Item Connectedness'        matrix_without_cog_cap = matrix[:, 1:]        similarity_matrix = matrix_without_cog_cap.dot(matrix_without_cog_cap.T)        sum_knowl_array = similarity_matrix.sum(axis=0)        axs[place].plot(sum_knowl_array)        axs[place].set_xlabel('Microskills')        axs[place].set_ylabel('Sum Knowledge')        axs[place].set_title(title)    def check_test_structure(self, axs, place, plot_nr):        """ Plot with required cognitive capacity and average cognitive capacity for m in test matrix """        for person in range(1):            cog_cap = self.simulation.get_cog_cap(person)            test_timepoint = int((params.nrOfTestOccasions / params.TOTAL_YEARS_OF_SIMULATION) * params.TEST_AGE)            axs[place].plot(np.arange(params.nrOfMicroskillsIQ), self.simulation.test_matrix[:, 0],                     label='Required Cognitive Capacity')            axs[place].plot(np.arange(params.nrOfMicroskillsIQ), cog_cap[test_timepoint:int(test_timepoint + 100)],                     label='Person (p=' + str(person) + ') Cognitive Capacity')        axs[place].set_xlabel('Microskills')        axs[place].set_ylabel('Cognitive Capacity')        axs[place].set_title(str(plot_nr) + ': Test Structure')        axs[place].legend()    def check_learning_structure(self, axs, place, plot_nr):        """" PLot total number of skills learned per timepoint """        # TODO: We then check whether, if the proportion of microskills offered at the right age (set at 50%) above goes to        #  a lower percentage, less is learned.        start_p = int(0)        last_p = int(10)        learning_matrix_without_test_select_pers = self.learning_matrix[:-100, start_p:last_p]  # microskill, person        learned_skills_per_timepoint_matrix = np.cumsum(learning_matrix_without_test_select_pers, axis=0)        for person in range(last_p):            axs[place].plot(learned_skills_per_timepoint_matrix[:, person], label='Person: ' + str(person))        axs[place].set_title(str(plot_nr) + ": Microskills Learned per Timepoint")        axs[place].set_xlabel('Timepoints')        axs[place].set_ylabel('Nr of Learned Microskills')        axs[place].legend()    def check_learning_correlations(self, axs, place, plot_nr):        """ Correlations with sum of learned skills and cognitive capacity and concentration """        learning_matrix_without_test = self.learning_matrix[:-100, :]  # microskill, person        learned_skills_per_timepoint_matrix = np.cumsum(learning_matrix_without_test, axis=0)        corr_sum_knowl_conc = []        corr_sum_knowl_cog_cap = []        for timepoint in range(1000):            corr_conc = np.corrcoef(learned_skills_per_timepoint_matrix[timepoint, :], self.simulation.concentration_matrix[timepoint, :])[0, 1]            corr_sum_knowl_conc.append(corr_conc)            corr_cog_cap = np.corrcoef(learned_skills_per_timepoint_matrix[timepoint, :], self.simulation.cog_cap_matrix[timepoint, :])[0, 1]            corr_sum_knowl_cog_cap.append(corr_cog_cap)        axs[place].plot(corr_sum_knowl_conc, label='Concentration')        axs[place].plot(corr_sum_knowl_cog_cap, label='Cog cap')        axs[place].set_title(str(plot_nr) + ": Correlation With Learned Skills")        axs[place].set_xlabel('Timepoints')        axs[place].set_ylabel('Correlation')        axs[place].legend()    def check_iq_scores(self, axs, place, characteristic, plot_nr):        """ Check correlation between iq score and concentration/cognitive capacity """        # TODO: Calulcate iq scores (check variance, and correlation + factor analysis) + take correlation at timepoint of test?        # TODO: correlation scores        start_p = int(0)        last_p = params.nrOfPersInTest        cog_cap_all = self.simulation.personality_matrix[start_p:last_p, 0]  # person, charchateristic        conc_all = self.simulation.personality_matrix[start_p:last_p, 1]  # person, charachteristic        print(cog_cap_all)        IQ_test_selected_persons = self.learning_matrix[1000:, start_p:last_p]  # microskill, person        raw_iq_scores = IQ_test_selected_persons.sum(axis=0)        print(raw_iq_scores)        corr_cog_cap = np.corrcoef(raw_iq_scores, cog_cap_all)[0, 1]        corr_conc = np.corrcoef(raw_iq_scores, conc_all)[0, 1]        if characteristic == 'cog_cap':            fit1 = np.polyfit(raw_iq_scores, cog_cap_all, deg=1)  # add regression line to plot            axs[place].plot(raw_iq_scores,  cog_cap_all, 'bo')            axs[place].plot(raw_iq_scores, fit1[0] * raw_iq_scores + fit1[1])            axs[place].set_title(str(plot_nr) + ': Corr IQ score and Cognitive Capacity: ' + str(round(corr_cog_cap, 2)))            axs[place].set_xlabel('Raw IQ Scores')            axs[place].set_ylabel('Cognitive Capacity')        if characteristic == 'concentration':            fit2 = np.polyfit(raw_iq_scores, conc_all, deg=1)            axs[place].plot(raw_iq_scores, conc_all, 'bo')            axs[place].plot(raw_iq_scores, fit2[0] * raw_iq_scores + fit2[1])            axs[place].set_title(str(plot_nr) + ': Corr IQ Score and Concentration: ' + str(round(corr_conc, 2)))            axs[place].set_xlabel('Raw IQ Scores')            axs[place].set_ylabel('Concentration')        # print('Variance: ' + str(np.var(raw_iq_scores)))        #        # plt.bar(np.arange(len(raw_iq_scores)), raw_iq_scores)        # plt.xticks(np.arange(len(raw_iq_scores)), rotation=90)        # plt.title("Raw IQ-test Scores")        # plt.xlabel('Persons')        # plt.ylabel('Nr of Items Passed')        # plt.show()